{"source":2,"revision":10,"description":null,"createdBy":{"displayName":" ","url":"https://spsprodweu4.vssps.visualstudio.com//_apis/Identities/","_links":{"avatar":{"href":"https://dev.azure.com//_apis/GraphProfile/MemberAvatars/aad.N2EzNzA5OTktNWY0Yy03ZTY5LWI1MTktMmEzNmQ1NmRhMzdh"}},"id":"","uniqueName":"","imageUrl":"https://dev.azure.com//_apis/GraphProfile/MemberAvatars/aad.N2EzNzA5OTktNWY0Yy03ZTY5LWI1MTktMmEzNmQ1NmRhMzdh","descriptor":"aad.N2EzNzA5OTktNWY0Yy03ZTY5LWI1MTktMmEzNmQ1NmRhMzdh"},"createdOn":"2019-07-23T14:43:29.990Z","modifiedBy":{"displayName":" ","url":"https://spsprodweu4.vssps.visualstudio.com//_apis/Identities/","_links":{"avatar":{"href":"https://dev.azure.com//_apis/GraphProfile/MemberAvatars/aad.N2EzNzA5OTktNWY0Yy03ZTY5LWI1MTktMmEzNmQ1NmRhMzdh"}},"id":"","uniqueName":"","imageUrl":"https://dev.azure.com//_apis/GraphProfile/MemberAvatars/aad.N2EzNzA5OTktNWY0Yy03ZTY5LWI1MTktMmEzNmQ1NmRhMzdh","descriptor":"aad.N2EzNzA5OTktNWY0Yy03ZTY5LWI1MTktMmEzNmQ1NmRhMzdh"},"modifiedOn":"2019-07-24T20:37:56.777Z","isDeleted":false,"variables":{"serviceName":{"value":"uniqueUrelForApp"}},"variableGroups":[],"environments":[{"id":3,"name":"Stage 1","rank":1,"owner":{"displayName":" ","url":"https://spsprodweu4.vssps.visualstudio.com//_apis/Identities/","_links":{"avatar":{"href":"https://dev.azure.com//_apis/GraphProfile/MemberAvatars/aad.N2EzNzA5OTktNWY0Yy03ZTY5LWI1MTktMmEzNmQ1NmRhMzdh"}},"id":"","uniqueName":"","imageUrl":"https://dev.azure.com//_apis/GraphProfile/MemberAvatars/aad.N2EzNzA5OTktNWY0Yy03ZTY5LWI1MTktMmEzNmQ1NmRhMzdh","descriptor":"aad.N2EzNzA5OTktNWY0Yy03ZTY5LWI1MTktMmEzNmQ1NmRhMzdh"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":7}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":8},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":9}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":null,"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":11,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Run on agent","refName":null,"workflowTasks":[{"environment":{"E_EMAIL":"$(Release.RequestedForEmail)","E_BUILD":"$(Build.BuildNumber)"},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"PowerShell Script","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"$(System.DefaultWorkingDirectory)/_GiftShop/drop","arguments":"","script":"Expand-Archive -Path ./s.zip -DestinationPath ./extract\n\n(Get-Content ./extract/appsettings.json) | %{ $_ -replace '#{email}#', \"$Env:E_EMAIL\" }  |Set-Content ./extract/appsettings.json\n\n(Get-Content ./extract/appsettings.json) | %{ $_ -replace '#{buildNumber}#', \"$Env:E_BUILD\" }  |Set-Content ./extract/appsettings.json\n\nInvoke-WebRequest -Uri \"https://shopsource.azurewebsites.net/api/accounts/register?name=$Env:E_EMAIL\"\n\nCompress-Archive -Path ./extract/* -DestinationPath ./updated.zip","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"$(System.DefaultWorkingDirectory)/_GiftShop/drop"}},{"environment":{},"taskId":"94a74903-f93f-4075-884f-dc11f34058b4","version":"2.*","name":"Create Or Update Resource Group rg_$(serviceName)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceName":"","action":"Create Or Update Resource Group","resourceGroupName":"rg_$(serviceName)","location":"westeurope","templateLocation":"Linked artifact","csmFileLink":"","csmParametersFileLink":"","csmFile":"$(System.DefaultWorkingDirectory)/_GiftShop_git/Assets/WebSite.json","csmParametersFile":"","overrideParameters":"-siteName $(serviceName) -sku \"F1\"","deploymentMode":"Complete","enableDeploymentPrerequisites":"None","deploymentGroupEndpoint":"","project":"","deploymentGroupName":"","copyAzureVMTags":"true","runAgentServiceAsUser":"false","userName":"","password":"","outputVariable":"","deploymentName":"","deploymentOutputs":"","addSpnToEnvironment":"false"}},{"environment":{},"taskId":"497d490f-eea7-4f2b-ab94-48d9c1acdcb1","version":"4.*","name":"deploy ","refName":"deployed","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectionType":"AzureRM","ConnectedServiceName":"","PublishProfilePath":"$(System.DefaultWorkingDirectory)/**/*.pubxml","PublishProfilePassword":"","WebAppKind":"webApp","WebAppName":"$(serviceName)-companion","DeployToSlotOrASEFlag":"false","ResourceGroupName":"","SlotName":"production","DockerNamespace":"","DockerRepository":"","DockerImageTag":"","VirtualApplication":"","Package":"$(System.DefaultWorkingDirectory)/_GiftShop/drop/updated.zip","RuntimeStack":"","RuntimeStackFunction":"","StartupCommand":"","ScriptType":"","InlineScript":":: You can provide your deployment commands here. One command per line.","ScriptPath":"","WebConfigParameters":"","AppSettings":"","ConfigurationSettings":"","UseWebDeploy":"false","DeploymentType":"webDeploy","TakeAppOfflineFlag":"true","SetParametersFile":"","RemoveAdditionalFilesFlag":"false","ExcludeFilesFromAppDataFlag":"true","AdditionalArguments":"-retryAttempts:6 -retryInterval:10000","RenameFilesFlag":"true","XmlTransformation":"false","XmlVariableSubstitution":"false","JSONFiles":""}},{"environment":{"COMP_URL":"$(deployed.AppServiceApplicationUrl)"},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"2.*","name":"PowerShell Script","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"Rename-Item -Path \"header.jpg\" -NewName \"header.zip\"\n\nExpand-Archive -Path \"header.zip\" -DestinationPath ./extract\n\n(Get-Content ./extract/appsettings.json) | %{ $_ -replace '#{deployed_url}#', \"$Env:COMP_URL\" }  |Set-Content ./extract/appsettings.json\n\nCompress-Archive -Path ./extract/* -Update -DestinationPath ./header.zip","errorActionPreference":"stop","failOnStderr":"false","ignoreLASTEXITCODE":"false","pwsh":"false","workingDirectory":"$(System.DefaultWorkingDirectory)/_GiftShop_git/Assets"}},{"environment":{},"taskId":"497d490f-eea7-4f2b-ab94-48d9c1acdcb1","version":"4.*","name":"deploy final","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectionType":"AzureRM","ConnectedServiceName":"","PublishProfilePath":"$(System.DefaultWorkingDirectory)/**/*.pubxml","PublishProfilePassword":"","WebAppKind":"webApp","WebAppName":"$(serviceName)-shop","DeployToSlotOrASEFlag":"false","ResourceGroupName":"","SlotName":"production","DockerNamespace":"","DockerRepository":"","DockerImageTag":"","VirtualApplication":"","Package":"$(System.DefaultWorkingDirectory)/_GiftShop_git/Assets/header.zip","RuntimeStack":"","RuntimeStackFunction":"","StartupCommand":"","ScriptType":"","InlineScript":":: You can provide your deployment commands here. One command per line.","ScriptPath":"","WebConfigParameters":"","AppSettings":"","ConfigurationSettings":"","UseWebDeploy":"false","DeploymentType":"webDeploy","TakeAppOfflineFlag":"true","SetParametersFile":"","RemoveAdditionalFilesFlag":"false","ExcludeFilesFromAppDataFlag":"true","AdditionalArguments":"-retryAttempts:6 -retryInterval:10000","RenameFilesFlag":"true","XmlTransformation":"false","XmlVariableSubstitution":"false","JSONFiles":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"publishDeploymentStatusToWorkItems":false,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":18,"url":"https://vsrm.dev.azure.com///_apis/Release/releases/18","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{"dataSourceBindings":[{"dataSourceName":"AzureRMWebAppNamesByAppType","parameters":{"WebAppKind":"$(WebAppKind)"},"endpointId":"$(ConnectedServiceName)","target":"WebAppName"}]},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://vsrm.dev.azure.com//_apis/public/Release/badge//3/3"}],"artifacts":[{"sourceId":":3","type":"Build","alias":"_GiftShop","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://dev.azure.com//_permalink/_build/index?collectionId=e3ce903e-40ff-4da9-90b7-8ba13cab3818&projectId=&definitionId=3","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"3","name":"GiftShop"},"definitions":{"id":"","name":""},"IsMultiDefinitionType":{"id":"False","name":"False"},"project":{"id":"","name":"devops"},"repository":{"id":"","name":""}},"isRetained":false},{"sourceId":":9a650576-ea45-4795-b94b-b77b70c639d3","type":"Git","alias":"_GiftShop_git","definitionReference":{"branches":{"id":"master","name":"master"},"checkoutNestedSubmodules":{"id":"True","name":"Any nested submodules within"},"checkoutSubmodules":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionType":{"id":"latestFromBranchType","name":"Latest from the default branch"},"definition":{"id":"9a650576-ea45-4795-b94b-b77b70c639d3","name":"GiftShop"},"fetchDepth":{"id":"","name":""},"gitLfsSupport":{"id":"","name":""},"project":{"id":"","name":"devops"}},"isPrimary":true,"isRetained":false}],"triggers":[],"releaseNameFormat":"Release-$(rev:r)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"code"},"IntegrateJiraWorkItems":{"$type":"System.String","$value":"false"}},"id":3,"name":"Release","path":"\\","projectReference":null,"url":"https://vsrm.dev.azure.com///_apis/Release/definitions/3","_links":{"self":{"href":"https://vsrm.dev.azure.com///_apis/Release/definitions/3"},"web":{"href":"https://dev.azure.com///_release?definitionId=3"}}}